import{_ as e,k as l,y as a,w as t,j as s,n as i,p as c,v as u,u as o,e as n,f as d,h as r,F as _,l as m,G as f,z as p,H as v,K as k,m as y,A as g,t as h,B as x,r as b,a as C,b as w,s as z,a0 as $,i as j,S as L,$ as T,a1 as B,T as O,a2 as S,q as A,a3 as E,L as I,a4 as V,O as F,x as M,X as N,C as q}from"./index-C8SuCoiN.js";import{_ as G}from"./uni-icons.CrP5nmgM.js";import{a as H}from"./time.Bo7V4Rh2.js";import{P as K}from"./index.DkLiy4Dr.js";import"./image.CYzgXnSN.js";const P=e({__name:"Sort",props:{mode:Number},emits:{change:Function},setup(e,{emit:o}){const n=e,d=o;function r(e){e!=n.mode&&(console.log(e),d("change",e))}return(o,n)=>{const d=u;return l(),a(d,{class:"box"},{default:t((()=>[s(d,{class:i(1==e.mode?"active":""),onClick:n[0]||(n[0]=e=>r(1))},{default:t((()=>[c(" 热度 ")])),_:1},8,["class"]),s(d,{class:i(2==e.mode?"active":""),onClick:n[1]||(n[1]=e=>r(2))},{default:t((()=>[c(" 时间 ")])),_:1},8,["class"])])),_:1})}}},[["__scopeId","data-v-1d3bfca0"]]),U=e({__name:"CommentList",props:{cList:Array,uid:Number},emits:["open"],setup(e,{emit:i}){o().config;const b=e,C=i,w=()=>{console.log("a")},z=()=>{g({icon:"none",title:"暂时不支持该操作",duration:2e3})},$=(e,l)=>{l?g({icon:"none",title:"你不能回复自己的评论",duration:2e3}):C("open",e)};return(i,o)=>{const g=h,C=u,j=n(d("uni-icons"),G),L=x;return b.cList.length?(l(),a(C,{key:0,class:"list"},{default:t((()=>[(l(!0),r(_,null,m(b.cList,((u,n)=>f((l(),a(C,{class:"item"},{default:t((()=>[s(C,{class:"left",onClick:o[0]||(o[0]=e=>w())},{default:t((()=>[s(g,{src:u.user.avatar},null,8,["src"])])),_:2},1024),s(C,{class:"right"},{default:t((()=>[s(C,{class:"nickname"},{default:t((()=>[s(C,null,{default:t((()=>[c(p(u.user.nickname),1)])),_:2},1024),f(s(C,{class:"sign"},{default:t((()=>[c(" 楼主 ")])),_:2},1536),[[v,u.uid==e.uid]])])),_:2},1024),s(C,{onClick:k((l=>$({comment_id:u.id,ruid:0},u.uid==e.uid)),["stop"])},{default:t((()=>[s(C,{class:"text"},{default:t((()=>[c(p(u.content),1)])),_:2},1024),s(C,{class:"flex"},{default:t((()=>[s(C,{class:"l"},{default:t((()=>[s(C,{class:"time"},{default:t((()=>[c(p(y(H)(1e3*u.createtime)),1)])),_:2},1024),s(C,{class:"reply"},{default:t((()=>[c(" 回复 ")])),_:1})])),_:2},1024),s(C,{class:"space"}),s(C,{class:"r",onClick:o[1]||(o[1]=k((e=>z()),["stop"]))},{default:t((()=>[s(j,{type:"hand-up",size:"40rpx",color:"#919191"}),f(s(C,{class:"num"},{default:t((()=>[c(p(u.like_number),1)])),_:2},1536),[[v,i.like_number]])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"]),(l(!0),r(_,null,m(u.replies,(i=>(l(),a(C,{class:"item replies"},{default:t((()=>[s(C,{class:"left",onClick:o[2]||(o[2]=e=>w()),style:{"margin-left":"5rpx"}},{default:t((()=>[s(g,{src:i.user.avatar},null,8,["src"])])),_:2},1024),s(C,{class:"right"},{default:t((()=>[s(C,{class:"nickname"},{default:t((()=>[s(C,null,{default:t((()=>[c(p(i.user.nickname)+" ",1),f(s(L,null,{default:t((()=>[c(" > "+p(i.ruser),1)])),_:2},1536),[[v,i.ruser]])])),_:2},1024),f(s(C,{class:"sign"},{default:t((()=>[c(" 楼主 ")])),_:2},1536),[[v,e.uid==i.user.id]])])),_:2},1024),s(C,{onClick:k((l=>$({comment_id:u.id,ruid:i.user.id},i.user.id==e.uid)),["stop"])},{default:t((()=>[s(C,{class:"text"},{default:t((()=>[c(p(i.content),1)])),_:2},1024),s(C,{class:"flex"},{default:t((()=>[s(C,{class:"l"},{default:t((()=>[s(C,{class:"time"},{default:t((()=>[c(p(y(H)(1e3*i.createtime)),1)])),_:2},1024),s(C,{class:"reply"},{default:t((()=>[c(" 回复 ")])),_:1})])),_:2},1024),s(C,{class:"space"}),s(C,{class:"r",onClick:o[3]||(o[3]=k((e=>z()),["stop"]))},{default:t((()=>[s(j,{type:"hand-up",size:"40rpx",color:"#919191"}),f(s(C,{class:"num"},{default:t((()=>[c(p(i.like_number),1)])),_:2},1536),[[v,i.like_number]])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),256))])),_:2},1024)])),_:2},1536)),[[v,u.id]]))),256))])),_:1})):(l(),a(C,{key:1,style:{"text-align":"center","font-size":"24rpx",color:"#BEBEBE","margin-top":"100rpx"}},{default:t((()=>[c(" 暂无评论快来抢占沙发🛋 ")])),_:1}))}}},[["__scopeId","data-v-dd2b03ec"]]),X=e({__name:"index",setup(e){const k=o().config,X=b(1),D=b([]);let J=0;const Q=(e,l)=>{l?S({url:e}):A({url:e})},R=async(e=1)=>{let{data:l}=await j(`/community/topics/comments/${J}?sort=${e}`);1==l.code?le.value=l.data:(g({icon:"none",title:l.msg,duration:2e3}),le.value=[])},W=async()=>{let{data:{data:e}}=await j(`/community/topics/${J}`);Z.value=e,D.value=e.images};C((async e=>{try{uni.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})}catch(l){console.log("不支持分享")}J=e.id,W(),R(1)})),w((async()=>{await W(),await R(1),z()}));let Y=b("");const Z=b({id:1,uid:1,title:"",createtime:1723746227,content:"",images:[],is_block:!1,like_number:0,is_like:0,is_collect:0,views:0,tag_id:1,comment_number:0,eid:0,user:{id:1,avatar:"",nickname:"",is_block:!1}}),ee=b(!1),le=b([]),ae=b({}),te=e=>{ae.value={comment_id:e.comment_id||0,content:"",topic_id:Z.value.id,ruid:e.ruid||0,type:1},Y.value="",ee.value=!0},se=()=>{ee.value=!1},ie=()=>{E({data:location.href}),console.log("触发分享")},ce=async()=>{let e=await I({title:"提示",content:"是否要举报该帖子"});if(e.confirm){let e=prompt("请填写手机号，方便管理员核实");if(/^1(3|4|5|6|7|8|9)\d{9}$/.test(e)){let{data:l}=await j.post(`/community/report/${Z.value.id}`,{remark:`快捷举报联系方式:${e}`,reported_type:1});1==l.code?g({icon:"none",title:"举报成功，请留意电话",duration:2e3}):g({icon:"none",title:l.msg,duration:2e3})}else g({icon:"none",title:"手机号验证失败",duration:2e3})}else e.cancel&&console.log("用户点击取消");console.log("触发举报")};let ue=b("");const oe=async()=>{if(""==Y.value)ue.value="不能发送空评论",clearTimeout(null),setTimeout((()=>{ue.value=""}),2e3);else{ae.value.content=Y.value;let{data:e}=await j.post("/community/replies",V(ae.value));1==e.code?(Y.value="",ee.value=!1,g({title:"发表评论成功",duration:2e3,icon:"none"}),console.log(X.value),await R(X.value)):g({title:"发布失败",duration:2e3,icon:"none"})}},ne=async e=>{X.value=e,await R(e)};return(e,o)=>{const b=h,C=u,w=n(d("uni-icons"),G),z=x,S=F,A=$("botton"),E=q,I=M,V=L,J=N,R=n(d("up-popup"),T);return l(),r(_,null,[s(V,{"scroll-y":!0},{default:t((()=>[s(C,{id:"page"},{default:t((()=>[s(C,{class:"content"},{default:t((()=>[s(C,{class:"flex"},{default:t((()=>[s(C,{class:"left"},{default:t((()=>[B("div",{class:"avatar"},[s(b,{src:Z.value.user.avatar},null,8,["src"])])])),_:1}),s(C,{class:"right"},{default:t((()=>[s(C,{class:"header"},{default:t((()=>[s(C,null,{default:t((()=>[s(C,{class:"nickname"},{default:t((()=>[c(p(Z.value.user.nickname),1)])),_:1}),s(C,{class:"time"},{default:t((()=>[c(p(y(H)(1e3*Z.value.createtime)),1)])),_:1})])),_:1}),s(C,{class:"space"}),s(C,null,{default:t((()=>[s(S,{class:i(Z.value.is_like?"like active":"like"),onClick:o[0]||(o[0]=e=>(async e=>{let l=Z.value.id;if(e){let{data:e}=await j.delete(`/community/like/topics/${l}`);1==(null==e?void 0:e.code)?(g({title:e.data,duration:2e3}),Z.value.is_like=!Z.value.is_like,Z.value.like_number=Z.value.like_number-1):g({title:e.msg,duration:2e3})}else{let{data:e}=await j.post(`/community/like/topics/${l}`);1==(null==e?void 0:e.code)?(g({title:e.data,duration:2e3}),Z.value.is_like=!Z.value.is_like,Z.value.like_number=Z.value.like_number+1):g({title:e.msg,duration:2e3})}})(Z.value.is_like))},{default:t((()=>[s(w,{type:"hand-up",size:"40rpx",color:"#919191"}),f(s(z,null,{default:t((()=>[c(p(Z.value.like_number),1)])),_:1},512),[[v,Z.value.like_number]])])),_:1},8,["class"])])),_:1})])),_:1}),s(C,{class:"body"},{default:t((()=>[s(C,null,{default:t((()=>[c(p(Z.value.title)+" "+p(Z.value.content),1)])),_:1})])),_:1}),s(y(K),{images:D.value},null,8,["images"]),s(C,{class:"below"},{default:t((()=>[s(C,{class:"tag"},{default:t((()=>{var e;return[c("# "+p(null==(e=y(k).tags.find((e=>e.id==Z.value.tag_id)))?void 0:e.tag),1)]})),_:1}),s(C,{class:"space"}),s(C,{class:"btn-group"},{default:t((()=>[s(A,{"open-type":"share",onClick:ie,class:"share"},{default:t((()=>[s(w,{type:"undo",color:"#999999",size:"30rpx"}),c(" 分享 ")])),_:1}),s(C,{onClick:ce},{default:t((()=>[s(w,{type:"calendar",color:"#999999",size:"30rpx"}),c(" 举报 ")])),_:1}),s(C,{onClick:o[1]||(o[1]=e=>(async e=>{let l=Z.value.id;if(e){let{data:e}=await j.delete(`/community/my/collect/topics/${l}`);1==(null==e?void 0:e.code)?(g({title:e.data,duration:2e3}),Z.value.is_collect=!Z.value.is_collect):console.log("失败")}else{let{data:e}=await j.post(`/community/collect/topics/${l}`);1==(null==e?void 0:e.code)?(g({title:e.data,duration:2e3}),Z.value.is_collect=!Z.value.is_collect):console.log("失败")}})(Z.value.is_collect)),class:i(Z.value.is_collect?"collect active":"collect")},{default:t((()=>[s(w,{type:"star",color:"#999999",size:"30rpx"}),c(" "+p(Z.value.is_collect?"取消":"收藏"),1)])),_:1},8,["class"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),s(C,{class:"spread"},{default:t((()=>[s(I,{circular:"","indicator-dots":""},{default:t((()=>[(l(!0),r(_,null,m(y(k).spread,(e=>(l(),a(E,{onClick:l=>{return a=e.url,void(location=a);var a}},{default:t((()=>[s(b,{src:e.image,style:{width:"750rpx",height:"250rpx"}},null,8,["src"])])),_:2},1032,["onClick"])))),256))])),_:1})])),_:1}),s(C,{class:"review"},{default:t((()=>[s(C,{class:"header"},{default:t((()=>[s(C,{class:"title"},{default:t((()=>[c("评论（"+p(Z.value.comment_number)+"）",1)])),_:1}),s(C,{class:"space"}),s(P,{mode:X.value,onChange:ne},null,8,["mode"])])),_:1}),s(U,{onOpen:te,cList:le.value,uid:Z.value.uid},null,8,["cList","uid"]),s(C,{class:"below"},{default:t((()=>[s(C,{class:"copy"},{default:t((()=>[c(" 一键校园@2024 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),s(C,{class:"comment"},{default:t((()=>[s(C,{class:"avatar"},{default:t((()=>[s(b,{src:Z.value.user.avatar},null,8,["src"])])),_:1}),s(C,{class:"input",onClick:o[2]||(o[2]=e=>te({ruid:0}))},{default:t((()=>[s(C,null,{default:t((()=>[c("评论千万条，友善第一条...")])),_:1})])),_:1})])),_:1}),s(R,{closeOnClickOverlay:!0,show:ee.value,mode:"center",onClose:se,class:"modal"},{default:t((()=>[s(C,{style:{color:"red"}},{default:t((()=>[c(p(y(ue)),1)])),_:1}),s(C,{class:"header"},{default:t((()=>[c(" 发表评论 ")])),_:1}),s(C,{class:"body"},{default:t((()=>[s(C,{class:"box"},{default:t((()=>[s(J,{id:"t1",modelValue:y(Y),"onUpdate:modelValue":o[3]||(o[3]=e=>O(Y)?Y.value=e:Y=e),placeholder:"发表你的看法"},null,8,["modelValue"])])),_:1})])),_:1}),s(C,{class:"action"},{default:t((()=>[s(S,{onClick:oe,class:"issue"},{default:t((()=>[s(w,{type:"checkmarkempty",size:"26rpx",color:"#fff"}),c(" 发表")])),_:1})])),_:1})])),_:1},8,["show"]),s(C,{class:"sidebar"},{default:t((()=>[s(C,{onClick:o[4]||(o[4]=e=>Q("/pages/release/index"))},{default:t((()=>[s(w,{type:"compose",size:"34rpx",color:"#fff"}),s(C,null,{default:t((()=>[c("发布")])),_:1})])),_:1}),s(C,{onClick:o[5]||(o[5]=e=>Q("/pages/message/index",1))},{default:t((()=>[s(w,{type:"chatboxes",size:"34rpx",color:"#fff"}),s(C,null,{default:t((()=>[c("消息")])),_:1})])),_:1}),s(C,{onClick:o[6]||(o[6]=e=>Q("/pages/home/index",1))},{default:t((()=>[s(w,{type:"home",size:"34rpx",color:"#fff"}),s(C,null,{default:t((()=>[c("首页")])),_:1})])),_:1})])),_:1})],64)}}},[["__scopeId","data-v-2ab45395"]]);export{X as default};
