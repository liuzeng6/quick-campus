import{u as e,P as a,Q as l,_ as t,r as s,a as o,R as n,e as i,f as c,y as u,w as d,S as r,k as f,j as p,m,T as g,p as _,n as h,z as v,h as y,l as F,F as k,U as x,A as C,i as z,V,W as b,X as j,v as w,Y as P,K as D,t as U}from"./index-C8SuCoiN.js";import{_ as A}from"./uni-icons.CrP5nmgM.js";import{l as S,p as T}from"./image.CYzgXnSN.js";const I=e().config,J=e=>new Promise(((t,s)=>{a({url:l+"/community/single/resources",filePath:e,name:"file",header:{Authorization:I.openid},success:e=>{try{t(JSON.parse(e.data))}catch(a){s(a)}},fail(e){s(e)}})})),K=t({__name:"index",setup(e){let a=s([]),l=s(1),t=s(""),I=s(""),K=s([]),N=0;o((async e=>{l.value=e.mode||1;const{data:{data:t}}=await n();a.value=t.filter((e=>e.enable))}));const O=e=>{let t=e.detail.value;l.value=a.value[t].id,console.log(l)},Q=async()=>{if(t.value.length<2)return C({icon:"none",title:"标题不少于两个字",duration:2e3}),!1;if(I.value.length<5)return C({icon:"none",title:"内容不少于五个字",duration:2e3}),!1;if(1==N)return C({icon:"none",title:"请等待图片上传完成",duration:2e3}),!1;let e={content:I.value,resources:K.value,tag_id:l.value,title:t.value},{data:a}=await z.post("/community/topics/publish",e);1==a.code?(C({icon:"none",title:"发布成功",duration:2e3}),t.value="",I.value="",K.value=[]):C({icon:"none",title:"发布失败，联系管理员",duration:2e3})},R=async()=>{V({success:async e=>{const a=e.tempFilePaths;console.log(e);for(const t of a)try{N=1;let{data:e}=await J(t);K.value.push(e.filename),console.log(e)}catch(l){C({icon:"none",title:"上传失败",duration:2e3})}finally{N=2}}}),console.log("添加图片")};return(e,s)=>{const o=b,n=j,z=w,V=U,J=i(c("uni-icons"),A),N=P,W=r;return f(),u(W,{"scroll-y":!0,id:"page"},{default:d((()=>[p(z,{class:"edit"},{default:d((()=>[p(o,{type:"text",placeholder:"标题(不超过20个字)",class:"title",maxlength:"20",modelValue:m(t),"onUpdate:modelValue":s[0]||(s[0]=e=>g(t)?t.value=e:t=e)},null,8,["modelValue"]),p(n,{class:"input",placeholder:"详细描述你的需求，禁止发布重复信息，违法违规，广告营销类的内容",maxlength:"800",modelValue:m(I),"onUpdate:modelValue":s[1]||(s[1]=e=>g(I)?I.value=e:I=e)},{default:d((()=>[_("\r\n            ")])),_:1},8,["modelValue"]),p(z,{class:h(m(I).length?"count":"count hidden")},{default:d((()=>[_(v(m(I).length)+" / 800",1)])),_:1},8,["class"]),p(z,{class:"images"},{default:d((()=>[(f(!0),y(k,null,F(m(K),((e,a)=>(f(),u(z,{class:"item"},{default:d((()=>[p(V,{src:m(S)(e,!0),mode:"scaleToFill",onClick:s[2]||(s[2]=e=>m(T)(m(S)(m(K))))},null,8,["src"]),p(z,{class:"remove",onClick:D((e=>(e=>{K.value.splice(e,1)})(a)),["stop"])},{default:d((()=>[_(" × ")])),_:2},1032,["onClick"]),p(z,{class:"left",onClick:D((e=>(C({icon:"none",title:"不支持该操作",duration:2e3}),void console.log("上升"))),["stop"])},{default:d((()=>[p(J,{type:"left",size:"#FFFFFF",szie:"30rpx"})])),_:2},1032,["onClick"]),p(z,{class:"right",onClick:D((e=>(C({icon:"none",title:"不支持该操作",duration:2e3}),void console.log("下降"))),["stop"])},{default:d((()=>[p(J,{type:"right",size:"#FFFFFF",szie:"30rpx"})])),_:2},1032,["onClick"])])),_:2},1024)))),256)),m(K).length<9?(f(),u(z,{key:0,class:"add-image item",onClick:R},{default:d((()=>[p(z,{class:"add"},{default:d((()=>[_("+")])),_:1}),p(z,{class:"text"},{default:d((()=>[_("添加图片")])),_:1})])),_:1})):x("",!0)])),_:1}),p(z,{class:"select-label"},{default:d((()=>[p(z,{class:"left"},{default:d((()=>[_(" 帖子标签 ")])),_:1}),p(z,{class:"right"},{default:d((()=>[p(N,{onChange:O,range:m(a),"range-key":"tag"},{default:d((()=>[_(v(m(a).length?m(a).find((e=>e.id==m(l))).tag:"")+" ",1),p(J,{type:"right",size:"34rpx",color:"#9D9D9D"})])),_:1},8,["range"])])),_:1})])),_:1})])),_:1}),p(z,{class:"btn",onClick:Q},{default:d((()=>[p(J,{type:"compose",size:"34rpx",color:"#fff"}),p(z,null,{default:d((()=>[_("发布")])),_:1})])),_:1}),p(z,{class:"tips"},{default:d((()=>[_(" 请自觉遵守社区规范，如有违规会被删贴、禁言、关小黑屋 ")])),_:1})])),_:1})}}},[["__scopeId","data-v-bac31265"]]);export{K as default};
